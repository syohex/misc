# C++ Software Design

## 読了日

## URL

https://www.oreilly.com/library/view/c-software-design/9781098113155/

## 感想

### 全体の感想

- 知見が得られることも多少あったが本の分厚さには見合っていない印象を受けた
- STLの設計なんて考えたことなかったけど, デザインパターンの観点で見ると○○パターンになる, っていうのは面白かった. 言われてみるとたしかにそうで, 初期化からあるものでちゃんと考えられているんだなと思った. conceptがあるならまだしもそれがない時代からちゃんと設計できていたのはすごい.
- 速度の話を定期的に持ち出すのはいらなかったと思う
  - 今どき C++使う場合速度は重要である可能性は高いとは思うけど, それよりももっと設計にフォーカスしてほしい感じはあった
- 定期的に Strategyパターンの話が出るのは冗長な気がした.
- 設計について学びたい人がはじめに読む本ではない.
- C++も知っていて, デザインパターンも知っていてという人が読む本かと思った

### Guideline 01 Understand the Importance of Software Design

- この本は「ソフトウェアデザイン」の本であって C++の機能の本ではないということを何度も強調

### Guideline 02 Design for Change

- 関心の分離, 単一責任原則, DRYについて
- 基本的な解答はない. すべて `It depends` だ
- 早すぎる関心の分離はやめておけ
- `Don't try to achieve SOLID, use SOLID to archive maintainability`

### Guideline 04 Design for Testability

- private methodのテストをどうするかという話
- protectedにしてテスト用のクラスを継承するとか, publicにするとか, friend使うとかマクロで privateを publicに置き換えるとか色々よろしくない方法もあげられる.
- publicメソッドを経由して private methodの機能を確認すればいいんじゃないという意見も出てくるが, 実装変わったりしたら当初のテストの目的を達成できないケースもある
- 最終的に提案されるものは, privateをやめて public関数に切り出すという方法. 引数に必要最小限なものを渡すようにすれば, classの中にあるより良いカプセル化もできるとのこと
- テストすべき機能はそれ自身テストできるようにあるべきだからそれでいいんじゃないとの意見. 同一クラスであることにこだわることは意味があることではないとの意見.

感想 単体テストであれば Rustみたいにファイル内でテストが書ければ別にいい話で言語の性質に引っ張られてテストが書けなかったり, 手間が必要だったりってのは今どきイケていないなと思った. テストするための設計の重要性はもちろんあるが, 余計なことを考えないように済むために言語規格がなんとかなってほしいと願うところではある

### Guideline 6 Adhere to the expected behavior of abstractions

- リスコフの置換原則の話
- 抽象化は requirementsと expectationsの表現である
- 数学的などでは成り立つ関係がソフトウェア的になりたつとは限らない. 例長方形と正方形. インターフェス次第ではリスコフの置換原則を満たさないという話を例を挙げて説明

### Guideline 17: Consider std::variant for Implementing Visitor

- `std::variant` を使った visitorパターンの実装の話
- `std::variant` + `std::visit` で代数的データ型っぽく使う
- 静的にメソッド解決などをできるため, 動的なポリモーフィズムよりもパフォーマンス的にも良いとのこと

`std::variant`の使い方を初めて知った. どういうところに利用できるのかわかってなかったけど, `std::visit` と合わせて使うものだったのか
